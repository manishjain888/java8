<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    <!--
    	Auto Funding Messages TABLE MAPPING
    -->
    <sqlMap namespace="RBSGBL_FUNDING_MESSAGE">
    		<resultMap id="outMsgMap" class="com.rbs.rbsgbl.loaniq.funding.datastore.data.AutoFund">
    		<result column="AFT_WSS_TRADE_REF" property="aftWSSTradeRef" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_INT_ID" property="aftWSSIntID" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_MAP_REF" property="aftWssMapRef" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_CITY_CDE" property="aftCityCode" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_MSG_TYPE" property="aftMsgType" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_TRADE_TYPE" property="aftTradeTypeCode" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_AMEND_TYPE" property="aftAmendTypeCode" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_PROD_TYPE" property="aftWSSProdType" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_BUS_AREA" property="aftWSSBusArea" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_PORTFOLIO" property="aftWSSPortfolio" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_CURRENCY" property="aftCurrencyCode" jdbcType="VARCHAR" /> 
			<result column="AFT_PCT_RATE" property="aftPctRate" jdbcType="NUMBER" /> 
			<result column="AFT_CDE_RATE_TYPE" property="aftRateTypeCode" jdbcType="VARCHAR" /> 
			<result column="AFT_AMT_FUND" property="aftFundAmount" jdbcType="NUMBER" /> 
			<result column="AFT_IND_INT_FLAG" property="aftIndIntFlag" jdbcType="VARCHAR" /> 
			<result column="AFT_DTE_START" property="aftStartDate" jdbcType="TIMESTAMP" /> 
			<result column="AFT_DTE_TRADE" property="aftTradeDate" jdbcType="TIMESTAMP" /> 
			<result column="AFT_DTE_MATURITY" property="aftMaturityDate" jdbcType="TIMESTAMP" /> 
			<result column="AFT_WSS_CPTY_ID" property="aftWSSCounterPartyID" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_WSS_RATE_BASIS" property="aftWSSRateBasisCode" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_RATE_INDEX" property="aftCodeRateIndex" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_TRADER_ID" property="aftWSSTraderID" jdbcType="VARCHAR" /> 
			<result column="AFT_RID_CUST_REF" property="aftCustRefRID" jdbcType="VARCHAR" /> 
			<result column="AFT_DSC_REMARK_2" property="aftDSCRemark2" jdbcType="VARCHAR" /> 
			<result column="AFT_DSC_REMARK_1" property="aftDSCRemark1" jdbcType="VARCHAR" /> 
			<result column="AFT_DSC_REMARK_3" property="aftDSCRemark3" jdbcType="VARCHAR" /> 
			<result column="AFT_DSC_CANCEL_REASON" property="aftDSCCancelReason" jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_BF_FEE" property="aftFeeBFCode" jdbcType="VARCHAR" /> 
			<result column="AFT_DTE_BF_FEE" property="aftFeeBFDate" jdbcType="TIMESTAMP" /> 
			<result column="AFT_NUM_BF_FEE" property="aftFeeBFNum" jdbcType="NUMBER" /> 
			<result column="AFT_WSS_PREV_ID" property="aftWSSPrevID" jdbcType="VARCHAR" /> 
			<result column="AFT_RID_SEQ_ID" property="aftSeqIDRID" jdbcType="VARCHAR" /> 
			<result column="AFT_RID_APP_ID" property="aftAppIDRID" jdbcType="VARCHAR" /> 
			<result column="AFT_TSP_SENT_ARGON" property="aftArgonSentTimestamp" jdbcType="TIMESTAMP" /> 
			<result column="AFT_CDE_MSG_STATUS" property="aftMSGStatusCode"  jdbcType="VARCHAR" /> 
			<result column="AFT_CDE_ACK_STATUS" property="aftACKStatusCode" jdbcType="VARCHAR" /> 
			<result column="AFT_TSP_ACK" property="aftACkTimestamp" jdbcType="TIMESTAMP" /> 
			<result column="AFT_WSS_INT_TRADE_ID" property="aftWSSIntTradeID" jdbcType="VARCHAR" /> 
			<result column="AFT_WSS_EXT_TRADE_ID" property="aftWSSExtTradeID" jdbcType="VARCHAR" /> 
			<result column="AFT_RID_FUND_REQ" property="aftFundReqRID" jdbcType="VARCHAR" />			
			<result column="AFT_WSS_CUST_REF" property="aftWssCustRef" jdbcType="VARCHAR" />
			<result column="AFT_OLD_WSS_MAP_REF" property="aftOldWSSMapRef" jdbcType="VARCHAR" />			 
		</resultMap>	
		
		<update id="updateOutboundMessageStatus" parameterClass="com.rbs.rbsgbl.loaniq.funding.datastore.data.AutoFund">
			UPDATE RBSGBL_AUTO_FUND set AFT_CDE_MSG_STATUS=#aftMSGStatusCode:VARCHAR#, AFT_RID_SEQ_ID=#aftSeqIDRID:VARCHAR#, AFT_TSP_SENT_ARGON=#aftArgonSentTimestamp:TIMESTAMP# 
			WHERE AFT_RID_APP_ID=#aftAppIDRID:NUMBER#
		</update>
		
		<update id="updateArgonAck" parameterClass="com.rbs.rbsgbl.loaniq.funding.datastore.data.AutoFund">
			UPDATE RBSGBL_AUTO_FUND set AFT_CDE_MSG_STATUS=#aftMSGStatusCode:VARCHAR#, AFT_CDE_ACK_STATUS=#aftACKStatusCode:VARCHAR#, AFT_TSP_ACK=#aftACkTimestamp:TIMESTAMP# ,
			AFT_WSS_INT_TRADE_ID = #aftWSSIntTradeID:VARCHAR#
			WHERE AFT_RID_FUND_REQ=#aftFundReqRID:VARCHAR#
		</update>			
				
		<select id="selectUnsentMessages" resultMap="outMsgMap" resultClass="java.util.List">
		<![CDATA[
			select AFT_WSS_TRADE_REF,AFT_WSS_INT_ID,AFT_WSS_MAP_REF,AFT_WSS_CITY_CDE,AFT_CDE_MSG_TYPE,
			AFT_CDE_TRADE_TYPE,AFT_CDE_AMEND_TYPE,AFT_WSS_PROD_TYPE,AFT_WSS_BUS_AREA ,
			AFT_WSS_PORTFOLIO,AFT_CDE_CURRENCY,AFT_PCT_RATE,AFT_CDE_RATE_TYPE,
			AFT_AMT_FUND,AFT_IND_INT_FLAG,AFT_DTE_START,AFT_DTE_TRADE,AFT_DTE_MATURITY,
			AFT_WSS_CPTY_ID,AFT_CDE_WSS_RATE_BASIS,AFT_CDE_RATE_INDEX,AFT_WSS_TRADER_ID,
			AFT_RID_CUST_REF,AFT_DSC_REMARK_2,AFT_DSC_REMARK_1,AFT_DSC_REMARK_3,AFT_DSC_CANCEL_REASON,
			AFT_CDE_BF_FEE,AFT_DTE_BF_FEE,AFT_NUM_BF_FEE,AFT_WSS_PREV_ID,AFT_RID_SEQ_ID,AFT_RID_APP_ID,
			AFT_TSP_SENT_ARGON,AFT_CDE_MSG_STATUS,AFT_CDE_ACK_STATUS,AFT_TSP_ACK,AFT_WSS_INT_TRADE_ID,
			AFT_WSS_EXT_TRADE_ID,AFT_RID_FUND_REQ,AFT_WSS_CUST_REF,AFT_OLD_WSS_MAP_REF	 		
			from 
			RBSGBL_AUTO_FUND where AFT_CDE_MSG_STATUS=' ' OR AFT_CDE_MSG_STATUS='UNSENT' ORDER BY AFT_RID_APP_ID		
			]]>
		</select>
		
			<select id="getAutoFundObjForExternalNumber" resultMap="outMsgMap" parameterClass="java.util.Map">
		<![CDATA[
			select AFT_WSS_TRADE_REF,AFT_WSS_INT_ID,AFT_WSS_MAP_REF,AFT_WSS_CITY_CDE,AFT_CDE_MSG_TYPE,
			AFT_CDE_TRADE_TYPE,AFT_CDE_AMEND_TYPE,AFT_WSS_PROD_TYPE,AFT_WSS_BUS_AREA ,
			AFT_WSS_PORTFOLIO,AFT_CDE_CURRENCY,AFT_PCT_RATE,AFT_CDE_RATE_TYPE,
			AFT_AMT_FUND,AFT_IND_INT_FLAG,AFT_DTE_START,AFT_DTE_TRADE,AFT_DTE_MATURITY,
			AFT_WSS_CPTY_ID,AFT_CDE_WSS_RATE_BASIS,AFT_CDE_RATE_INDEX,AFT_WSS_TRADER_ID,
			AFT_RID_CUST_REF,AFT_DSC_REMARK_2,AFT_DSC_REMARK_1,AFT_DSC_REMARK_3,AFT_DSC_CANCEL_REASON,
			AFT_CDE_BF_FEE,AFT_DTE_BF_FEE,AFT_NUM_BF_FEE,AFT_WSS_PREV_ID,AFT_RID_SEQ_ID,AFT_RID_APP_ID,
			AFT_TSP_SENT_ARGON,AFT_CDE_MSG_STATUS,AFT_CDE_ACK_STATUS,AFT_TSP_ACK,AFT_WSS_INT_TRADE_ID,
			AFT_WSS_EXT_TRADE_ID,AFT_RID_FUND_REQ,AFT_WSS_CUST_REF,AFT_OLD_WSS_MAP_REF	 		
			from 
			RBSGBL_AUTO_FUND where AFT_WSS_MAP_REF = #aftWssMapRef# 
			]]>
		</select>
		
			<select id="getAckMsgStatusCode" resultClass="string" parameterClass="string">
		<![CDATA[
				select trim(STATIC_VALUE_1) from RBSGBL_STATIC_DETAILS where STATIC_TYPE_ID = rpad('FND08',5,' ') and TO_CHAR(TO_NUMBER(KEY_VALUE_1)) = #status#
			]]>
		</select>
	
	</sqlMap>
