<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="LOANIQ_FUNDING">
     <resultMap id="FundRequest" class="com.rbs.rbsgbl.loaniq.funding.datastore.data.FundReq">					
			<result resultMap="LOANIQ_FUNDING.ostCOF" property="ostCOF" />
	</resultMap>
					
	<resultMap id="ostCOF" class="com.rbs.rbsgbl.loaniq.funding.datastore.data.OstCOF">
			<result column="OTC_CDE_BRANCH" property="branchCode" jdbcType="VARCHAR" />
			<result column="OTC_CDE_EXPENSE" property="expenseCode" jdbcType="VARCHAR" />
			<result column="OTC_CDE_PORTFOLIO" property="portfolioCode" jdbcType="VARCHAR" />
			<result column="OST_CDE_REPR_FREQ" property="reprFreqCode" jdbcType="VARCHAR" />
			<result column="OTC_AMT_AMOUNT" property="amtAmount" jdbcType="VARCHAR" />
			<result column="OTC_PCT_RATE" property="cofRate" jdbcType="VARCHAR" />
			<result column="OST_RID_OUTSTANDNG" property="outstadingRID" jdbcType="VARCHAR" />
			
			<result column="OST_CDE_PRICE_OPT" property="priceOPTCode" jdbcType="VARCHAR" />
			<result column="OST_PID_DEAL" property="dealPID" jdbcType="VARCHAR" />
			<result column="OST_PID_FACILITY" property="facilityPID" jdbcType="VARCHAR" />
			<result column="OST_CDE_CURRENCY" property="currencycode" jdbcType="VARCHAR" />
			<result column="OST_CID_BORROWER" property="borrowerCID" jdbcType="VARCHAR" />
			<result column="OST_DTE_EFFECTIVE" property="effectiveDate" jdbcType="TIMESTAMP" />
			
			<result column="OST_DTE_REPRICING" property="repricingDate" jdbcType="TIMESTAMP" />
			<result column="OST_CDE_ACR_PERIOD" property="accrualPeriodCode" jdbcType="VARCHAR" />
			<result column="OST_CDE_ENDTE_RULE" property="endDateRuleCode" jdbcType="VARCHAR" />
			<result column="OST_CDE_OBJ_STATE" property="objStateCodeOST" jdbcType="VARCHAR" />
			<result column="OST_CDE_OUTSTD_TYP" property="outstandingTypeCode" jdbcType="VARCHAR" />
			<result column="ORT_CDE_MFCF_RT_BS" property="mfcfRTBSCode" jdbcType="VARCHAR" />
			<result column="IPO_CDE_NONBUS_DAY" property="nonBusDayCode" jdbcType="VARCHAR" />
			
			<result column="rate_set_days_in_advance" property="setBillingFreq" jdbcType="VARCHAR" />
			<result column="OTC_RID_CUS_SVC_GR" property="custServicingGroup" jdbcType="VARCHAR" />
			<result column="OTC_RID_OST_TR_COF" property="outTransCOFRID" jdbcType="VARCHAR" />
			<result column="AltKey" property="circleID" jdbcType="VARCHAR" />
			<result column="OTR_CDE_OBJ_STATE" property="objStateCodeOTC" jdbcType="VARCHAR" />
			<result column="OTR_CDE_TYPE" property="typeCodeOTR" jdbcType="VARCHAR" />
			<result column="OTR_DTE_EFFECTIVE" property="effectiveDateOTR" jdbcType="TIMESTAMP" />
			<result column="OTR_DTE_REPRICING" property="repricingDateOTR" jdbcType="TIMESTAMP" />	
			<result column="TSP" property="createTimeStamp" jdbcType="TIMESTAMP" />
			<result column="OST_NME_ALIAS" property="loanAlias" jdbcType="VARCHAR" />				
	</resultMap>
	
	<!-- query will fetch the list of portential funding request object-->
	<select id="fetchFundRequestObjList" resultMap="LOANIQ_FUNDING.FundRequest" >
			<![CDATA[
			select OTC_CDE_BRANCH,OTC_CDE_EXPENSE,OTC_CDE_PORTFOLIO,OST_CDE_REPR_FREQ,OTC_AMT_AMOUNT,OTC_PCT_RATE,
			OST_RID_OUTSTANDNG,	OST_CDE_PRICE_OPT,OST_PID_DEAL,OST_PID_FACILITY,OST_CDE_CURRENCY,OST_CID_BORROWER,
			OST_DTE_EFFECTIVE,OST_DTE_REPRICING,OST_CDE_ACR_PERIOD,OST_CDE_ENDTE_RULE,OST_CDE_OBJ_STATE,OST_CDE_OUTSTD_TYP,
			ORT_CDE_MFCF_RT_BS,IPO_CDE_NONBUS_DAY,IPO_NUM_SET_FREQ rate_set_days_in_advance,OTC_RID_CUS_SVC_GR,OTC_RID_OST_TR_COF,
			ftr.FTR_IID_INV_ID as AltKey,OTR_CDE_OBJ_STATE,	OTR_CDE_TYPE,OTR_DTE_EFFECTIVE,	OTR_DTE_REPRICING,OTC_TSP_REC_CREATE TSP,
			OST_NME_ALIAS
			from  vls_ost_tr_cof_shr cof,vls_ost_tran left outer join vls_fac_commit_trn ftr on otr_rid_commit_trn = ftr.ftr_rid_commit_trn
			,vls_outstanding,VLS_OST_RATES,VLS_INT_PRC_OPTION,vls_branch
			where
			ost_rid_outstandng = otr_rid_outstandng
			and OTR_RID_OST_TRAN = OTC_RID_OST_TRAN 
			and ORT_RID_OUTSTANDNG = OST_RID_OUTSTANDNG
			and IPO_CDE_OPTION = OST_CDE_PRICE_OPT
			and IPO_PID_DEAL = OST_PID_DEAL
			AND OTC_CDE_BRANCH = BRN_CDE_BRANCH
			and BRN_CDE_TME_REGION  = 'ZONE2'
			and (OTC_TSP_REC_UPDATE >= TO_DATE(#POLLTIME#, 'DD-MON-YYYY HH24:MI:SS') 
			OR OTR_TSP_REC_UPDATE >= TO_DATE(#POLLTIME#, 'DD-MON-YYYY HH24:MI:SS')
			)
            ]]>   
	</select>    
         
</sqlMap>