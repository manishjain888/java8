<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	
	<bean id="fundDataProcessor" class="com.rbs.rbsgbl.loaniq.funding.process.FundDataProcessor" init-method="processFlow" destroy-method="doFinalize">	
		<property name="fundDataProcessBS" ref="fundDataProcessBS"/>
		<property name = "excelReadUtility" ref= "excelReadUtility"/>
	</bean>
	
	<bean id="excelReadUtility" class="com.rbs.rbsgbl.loaniq.generic.common.ExcelReadUtility" >
		<property name="excelPath" value="${FUND_EXCEL_PATH}"/>
		<property name="excelArchivePath" value="${FUND_EXCEL_ARCHIVE_PATH}"/>	
	</bean>	
	
	<bean id="fundDataProcessDAO" class="org.springframework.aop.framework.ProxyFactoryBean" > 
		<property name="target"> 
			<ref bean="fundDataProcessDAO_Target"/> 
		</property> 
		<property name="proxyInterfaces"> 
			<value>com.rbs.rbsgbl.loaniq.funding.datastore.FundDataProcessDAO</value> 
		</property> 
		<property name="interceptorNames">
         <list>
            <value>fundTracingThrowsAdvice</value>
         </list>
    </property>
		
	</bean>	
		
	  <bean id="AutoFundMessageGenerator"  class="com.rbs.rbsgbl.loaniq.funding.process.messagesender.AutoFundMessageGenerator">
    <property name="autoFundMessageBS"><ref bean="AutoFundMessageBS"/></property>
    <property name="argonClientHandler"><ref bean="ArgonClientHandler"/></property>
  </bean>	
		
	<bean id="fundDataProcessDAO_Target" class="com.rbs.rbsgbl.loaniq.funding.datastore.FundDataProcessDAOSpringImpl" > 	
		<property name="sqlMapClient" ref="sqlMapClient"/>	
	</bean>
	
	<bean id="fundDataProcessBS" parent="txProxyTemplate" > 
		<property name="target"> 
			<ref local="fundDataProcessBS_Target"/> 
		</property> 
		<property name="transactionAttributes">
	    	<props>
	    	  <prop key="*">PROPAGATION_REQUIRED</prop>
	   		</props>
	  </property> 
	  <property name="preInterceptors">
  		<list>
			<ref bean="fundTracingThrowsAdvice"/>
  	  		<ref bean="fundTracingPrimaryAdvisor"/>
  		</list>
   	  </property>
	</bean>
	
	<bean id="fundDataProcessBS_Target" class="com.rbs.rbsgbl.loaniq.funding.business.FundDataProcessBSImpl"> 	
		<property name="ostCofPoller" ref="ost_poller"/>
		<property name="circlePoller" ref="circle_poller"/>
		<property name="migrationPoller" ref="migration_poller"/>
		<property name="fundDataProcessDAO" ref="fundDataProcessDAO"/>	
		<property name="ostTransWorkflowEngine" ref="ostTransWorkflowEngine"/>	
		<property name="nonOstTransWorkflowEngine" ref="nonOstTransWorkflowEngine"/>
		<property name="autoFundingWorkflowEngine" ref="autoFundingWorkflowEngine"/>
		<property name="accuralWorflowEngine" ref="accuralWorflowEngine"/>
		<property name="staticDataCodeCount" value="${fundMessage.staticDataCodeCount}"/>
	</bean> 
	
	
	<bean id="ost_poller" class="org.springframework.aop.framework.ProxyFactoryBean" > 
		<property name="target"> 
			<ref bean="ost_cof_poller_Target"/> 
		</property> 
		<property name="proxyInterfaces"> 
			<value>com.rbs.rbsgbl.loaniq.funding.business.Poller</value> 
		</property>		
	</bean>	
	
	<bean id="circle_poller" class="org.springframework.aop.framework.ProxyFactoryBean" > 
		<property name="target"> 
			<ref bean="circle_poller_Target"/> 
		</property> 
		<property name="proxyInterfaces"> 
			<value>com.rbs.rbsgbl.loaniq.funding.business.Poller</value> 
		</property>		
	</bean>	
	
	<bean id="migration_poller" class="org.springframework.aop.framework.ProxyFactoryBean" > 
		<property name="target"> 
			<ref bean="migration_poller_Target"/> 
		</property> 
		<property name="proxyInterfaces"> 
			<value>com.rbs.rbsgbl.loaniq.funding.business.Poller</value> 
		</property>		
	</bean>	
		
	<bean id="ost_cof_poller_Target" class="com.rbs.rbsgbl.loaniq.funding.business.OstCOFPoller" />	
	<bean id="circle_poller_Target" class="com.rbs.rbsgbl.loaniq.funding.business.CirclePoller" />
	<bean id="migration_poller_Target" class="com.rbs.rbsgbl.loaniq.funding.business.MigrationPoller" />
	
	<bean id="fundMapper" class="com.rbs.rbsgbl.loaniq.funding.datastore.data.FundMapper" />	
	<bean id="ostTransWorkflowEngine" class="com.rbs.rbsgbl.loaniq.funding.business.OstTransWorkflowEngine" />
	<bean id="nonOstTransWorkflowEngine" class="com.rbs.rbsgbl.loaniq.funding.business.NonOstTransWorkflowEngine" />	
	<bean id="autoFundingWorkflowEngine" class="com.rbs.rbsgbl.loaniq.funding.business.AutoFundingWorkflowEngine" />	
	<bean id="accuralWorflowEngine" class="com.rbs.rbsgbl.loaniq.funding.business.AccuralWorflowEngine" />		
	<bean id="txProxyTemplate" abstract="true" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
	  <property name="transactionManager" ref="txManager"/>
	    <property name="transactionAttributes">
	       <props>
	          <prop key="*">PROPAGATION_REQUIRED</prop>
	       </props>
	    </property>
	</bean>
	
	<bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
  		<property name="dataSource" ref="oracleDataSource"/>
	</bean>
	
	<bean id="oracleDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="shutdown">
		<property name="driverClassName" value="${jdbc.oradriverClassName}" />
		<property name="url" value="${jdbc.oraurl}" />
		<property name="username" value="${jdbc.orausername}" />
		<!--<property name="password" value="${jdbc.orapassword}" />-->
		<property name="password">
			<bean id="passwordDecryptor.strPassword" class="org.springframework.beans.factory.config.PropertyPathFactoryBean"/>
		</property>
	</bean>	

   <!-- Advisor pointcut definition for before advice -->
   <bean id="fundTracingBeforeAdvisor"
      class="org.springframework.aop.support.RegexpMethodPointcutAdvisor">
      <property name="advice">
         <ref local="fundTracingBeforeAdvice"/>
      </property>
      <!--<property name="pattern">
         <value>.*</value>
      </property>-->
   </bean>
	
	  <!-- Advisor pointcut definition for Throws advice -->
	<bean id="fundTracingThrowsAdvisor"
      class="org.springframework.aop.support.RegexpMethodPointcutAdvisor">
      <property name="advice">
         <ref local="fundTracingThrowsAdvice"/>
      </property>
      <property name="patterns">
       <list>
         <value>.*</value>
         </list>
      </property>
   </bean>
   
   <bean id="fundTracingPrimaryAdvisor"
      class="org.springframework.aop.support.NameMatchMethodPointcutAdvisor">
      <property name="advice">
         <ref local="fundMethodInterceptorPrimary"/>
      </property>
        <property name="mappedName" value="initiateWorkflow"/>

   </bean>
   
    <bean id="fundTracingSecondaryAdvisor"
      class="org.springframework.aop.support.NameMatchMethodPointcutAdvisor">
      <property name="advice">
         <ref local="fundMethodInterceptorSecondary"/>
      </property>
      <property name="mappedName" value="processFundReqData"/>
   </bean>	

   <!-- Advice classes For implementing Fund Filter-->
   <bean id="fundTracingBeforeAdvice"
      class="com.rbs.rbsgbl.loaniq.generic.aop.advice.InterfaceTracingBeforeAdvice"/>
   <bean id="fundTracingAfterAdvice"
      class="com.rbs.rbsgbl.loaniq.generic.aop.advice.InterfaceTracingAfterAdvice"/>
	<bean id="fundTracingThrowsAdvice"
      class="com.rbs.rbsgbl.loaniq.generic.aop.advice.InterfaceThrowsAdvice"/>
	<bean id="fundMethodInterceptorPrimary" 
		class = "com.rbs.rbsgbl.loaniq.funding.business.advice.FundPrimaryFilterAdvice"/>	
	<bean id="fundMethodInterceptorSecondary" 
		class = "com.rbs.rbsgbl.loaniq.funding.business.advice.FundSecondaryFilterAdvice"/>
	
	<!-- Advisor pointcut definition for after advice 
   <bean id="fundTracingAfterAdvisor"
      class="org.springframework.aop.support.RegexpMethodPointcutAdvisor">
      <property name="advice">
         <ref local="fundTracingAfterAdvice"/>
      </property>
      <property name="pattern">
         <value>.*</value>
      </property>
   </bean>-->
   
   
</beans>